<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>风之琴模拟器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }
        
        header {
            text-align: center;
            padding: 20px;
            width: 100%;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00c9ff, #92fe9d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(0, 201, 255, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a5e6ff;
            margin-bottom: 15px;
        }
        
        .instructions {
            background-color: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            width: 100%;
            border-left: 4px solid #00c9ff;
        }
        
        .instructions h3 {
            color: #00c9ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions p {
            color: #cbd5e1;
            line-height: 1.6;
        }
        
        .keyboard-container {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 30px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 201, 255, 0.2);
        }
        
        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            gap: 8px;
        }
        
        .keyboard-row:last-child {
            margin-bottom: 0;
        }
        
        .key {
            width: 70px;
            height: 80px;
            background: linear-gradient(145deg, #2d3748, #1e293b);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .key:hover {
            transform: translateY(-3px);
            background: linear-gradient(145deg, #3b4860, #2d3a50);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .key.active {
            transform: translateY(2px);
            background: linear-gradient(145deg, #00c9ff, #0099cc);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .key-label {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f8fafc;
            margin-bottom: 5px;
        }
        
        .key-note {
            font-size: 0.9rem;
            color: #a5e6ff;
        }
        
        .row-label {
            color: #00c9ff;
            font-weight: bold;
            width: 40px;
            text-align: right;
            margin-right: 15px;
            align-self: center;
            font-size: 1.1rem;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(90deg, #00c9ff, #0099cc);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 201, 255, 0.3);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 201, 255, 0.4);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: rgba(255, 255, 255, 0.08);
            padding: 12px 20px;
            border-radius: 50px;
        }
        
        .volume-control label {
            font-weight: bold;
            color: #a5e6ff;
        }
        
        .volume-control input {
            width: 100px;
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            color: #94a3b8;
            font-size: 0.9rem;
            padding: 20px;
            width: 100%;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sound-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(0deg, rgba(0, 201, 255, 0.6), transparent);
            transition: height 0.3s ease;
        }
        
        .key.active .sound-wave {
            height: 30%;
        }
        
        @media (max-width: 768px) {
            .key {
                width: 50px;
                height: 70px;
            }
            
            .key-label {
                font-size: 1.2rem;
            }
            
            .key-note {
                font-size: 0.8rem;
            }
            
            .keyboard-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 576px) {
            .key {
                width: 40px;
                height: 60px;
            }
            
            .key-label {
                font-size: 1rem;
            }
            
            .key-note {
                font-size: 0.7rem;
            }
            
            .row-label {
                display: none;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-music"></i> 风之琴模拟器</h1>
            <p class="subtitle">三行键盘乐器 - 高音、中音、低音</p>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                <p>点击下方按键或使用键盘按键弹奏音乐。第一行（高音）对应键盘上的 Q W E R T Y U，第二行（中音）对应 A S D F G H J，第三行（低音）对应 Z X C V B N M。调整音量滑块可改变声音大小。</p>
            </div>
        </header>
        
        <div class="keyboard-container">
            <!-- 第一行：高音区 Q W E R T Y U -->
            <div class="keyboard-row">
                <div class="row-label">高音</div>
                <div class="key" data-key="Q" data-note="C6">
                    <div class="key-label">Q</div>
                    <div class="key-note">C6</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="W" data-note="D6">
                    <div class="key-label">W</div>
                    <div class="key-note">D6</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="E" data-note="E6">
                    <div class="key-label">E</div>
                    <div class="key-note">E6</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="R" data-note="F6">
                    <div class="key-label">R</div>
                    <div class="key-note">F6</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="T" data-note="G6">
                    <div class="key-label">T</div>
                    <div class="key-note">G6</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="Y" data-note="A6">
                    <div class="key-label">Y</div>
                    <div class="key-note">A6</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="U" data-note="B6">
                    <div class="key-label">U</div>
                    <div class="key-note">B6</div>
                    <div class="sound-wave"></div>
                </div>
            </div>
            
            <!-- 第二行：中音区 A S D F G H J -->
            <div class="keyboard-row">
                <div class="row-label">中音</div>
                <div class="key" data-key="A" data-note="C5">
                    <div class="key-label">A</div>
                    <div class="key-note">C5</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="S" data-note="D5">
                    <div class="key-label">S</div>
                    <div class="key-note">D5</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="D" data-note="E5">
                    <div class="key-label">D</div>
                    <div class="key-note">E5</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="F" data-note="F5">
                    <div class="key-label">F</div>
                    <div class="key-note">F5</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="G" data-note="G5">
                    <div class="key-label">G</div>
                    <div class="key-note">G5</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="H" data-note="A5">
                    <div class="key-label">H</div>
                    <div class="key-note">A5</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="J" data-note="B5">
                    <div class="key-label">J</div>
                    <div class="key-note">B5</div>
                    <div class="sound-wave"></div>
                </div>
            </div>
            
            <!-- 第三行：低音区 Z X C V B N M -->
            <div class="keyboard-row">
                <div class="row-label">低音</div>
                <div class="key" data-key="Z" data-note="C4">
                    <div class="key-label">Z</div>
                    <div class="key-note">C4</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="X" data-note="D4">
                    <div class="key-label">X</div>
                    <div class="key-note">D4</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="C" data-note="E4">
                    <div class="key-label">C</div>
                    <div class="key-note">E4</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="V" data-note="F4">
                    <div class="key-label">V</div>
                    <div class="key-note">F4</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="B" data-note="G4">
                    <div class="key-label">B</div>
                    <div class="key-note">G4</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="N" data-note="A4">
                    <div class="key-label">N</div>
                    <div class="key-note">A4</div>
                    <div class="sound-wave"></div>
                </div>
                <div class="key" data-key="M" data-note="B4">
                    <div class="key-label">M</div>
                    <div class="key-note">B4</div>
                    <div class="sound-wave"></div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="playDemo">
                <i class="fas fa-play"></i> 示例演奏
            </button>
            <button id="stopSound">
                <i class="fas fa-stop"></i> 停止声音
            </button>
            <div class="volume-control">
                <label for="volume"><i class="fas fa-volume-up"></i> 音量:</label>
                <input type="range" id="volume" min="0" max="100" value="70">
            </div>
        </div>
        
        <footer>
            <p>风之琴模拟器 &copy; 2023 | 使用Web Audio API制作 | 支持键盘QAZ三行输入</p>
            <p>提示：点击按键或使用键盘上的QAZ三行按键弹奏音乐</p>
        </footer>
    </div>

    <script>
        // 音频上下文
        let audioContext;
        let oscillatorNodes = [];
        let volume = 0.7; // 默认音量
        
        // 音符频率映射（以C大调为基础）
        const noteFrequencies = {
            "C4": 261.63,  // 低音C
            "D4": 293.66,  // 低音D
            "E4": 329.63,  // 低音E
            "F4": 349.23,  // 低音F
            "G4": 392.00,  // 低音G
            "A4": 440.00,  // 低音A
            "B4": 493.88,  // 低音B
            
            "C5": 523.25,  // 中音C
            "D5": 587.33,  // 中音D
            "E5": 659.25,  // 中音E
            "F5": 698.46,  // 中音F
            "G5": 783.99,  // 中音G
            "A5": 880.00,  // 中音A
            "B5": 987.77,  // 中音B
            
            "C6": 1046.50, // 高音C
            "D6": 1174.66, // 高音D
            "E6": 1318.51, // 高音E
            "F6": 1396.91, // 高音F
            "G6": 1567.98, // 高音G
            "A6": 1760.00, // 高音A
            "B6": 1975.53  // 高音B
        };
        
        // 键盘按键到音符的映射
        const keyToNote = {
            // 第一行（高音）
            "Q": "C6",
            "W": "D6",
            "E": "E6",
            "R": "F6",
            "T": "G6",
            "Y": "A6",
            "U": "B6",
            // 第二行（中音）
            "A": "C5",
            "S": "D5",
            "D": "E5",
            "F": "F5",
            "G": "G5",
            "H": "A5",
            "J": "B5",
            // 第三行（低音）
            "Z": "C4",
            "X": "D4",
            "C": "E4",
            "V": "F4",
            "B": "G4",
            "N": "A4",
            "M": "B4"
        };
        
        // 初始化音频上下文
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // 播放音符
        function playNote(note) {
            initAudioContext();
            
            // 停止当前相同音符的声音（避免重叠）
            stopNote(note);
            
            // 计算频率
            const frequency = noteFrequencies[note];
            if (!frequency) return;
            
            // 创建振荡器
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            // 配置振荡器
            oscillator.type = 'sine'; // 正弦波，听起来更像风琴
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            
            // 配置增益节点（音量控制）
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.5);
            
            // 连接节点
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // 开始播放
            oscillator.start();
            
            // 存储振荡器以便后续停止
            oscillatorNodes.push({
                note: note,
                oscillator: oscillator,
                gainNode: gainNode
            });
            
            // 1.5秒后自动停止
            setTimeout(() => {
                stopNote(note);
            }, 1500);
            
            return oscillator;
        }
        
        // 停止特定音符
        function stopNote(note) {
            oscillatorNodes = oscillatorNodes.filter(item => {
                if (item.note === note) {
                    item.gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                    setTimeout(() => {
                        item.oscillator.stop();
                    }, 100);
                    return false;
                }
                return true;
            });
        }
        
        // 停止所有声音
        function stopAllSounds() {
            oscillatorNodes.forEach(item => {
                item.gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                setTimeout(() => {
                    item.oscillator.stop();
                }, 100);
            });
            oscillatorNodes = [];
            
            // 移除所有激活状态
            document.querySelectorAll('.key.active').forEach(key => {
                key.classList.remove('active');
            });
        }
        
        // 按键按下处理
        function handleKeyDown(key) {
            const note = keyToNote[key];
            if (!note) return;
            
            // 播放音符
            playNote(note);
            
            // 添加激活状态
            const keyElement = document.querySelector(`.key[data-key="${key}"]`);
            if (keyElement) {
                keyElement.classList.add('active');
                
                // 1.5秒后移除激活状态（与声音持续时间匹配）
                setTimeout(() => {
                    keyElement.classList.remove('active');
                }, 1500);
            }
        }
        
        // 示例演奏
        function playDemoMelody() {
            stopAllSounds();
            
            // 示例旋律：简单的音阶
            const melody = [
                {key: "Z", delay: 0},    // C4
                {key: "X", delay: 300},  // D4
                {key: "C", delay: 600},  // E4
                {key: "V", delay: 900},  // F4
                {key: "B", delay: 1200}, // G4
                {key: "N", delay: 1500}, // A4
                {key: "M", delay: 1800}, // B4
                
                {key: "A", delay: 2100}, // C5
                {key: "S", delay: 2400}, // D5
                {key: "D", delay: 2700}, // E5
                {key: "F", delay: 3000}, // F5
                {key: "G", delay: 3300}, // G5
                {key: "H", delay: 3600}, // A5
                {key: "J", delay: 3900}, // B5
                
                {key: "Q", delay: 4200}, // C6
                {key: "W", delay: 4500}, // D6
                {key: "E", delay: 4800}, // E6
            ];
            
            melody.forEach(note => {
                setTimeout(() => {
                    const noteName = keyToNote[note.key];
                    if (noteName) {
                        playNote(noteName);
                        
                        // 视觉反馈
                        const keyElement = document.querySelector(`.key[data-key="${note.key}"]`);
                        if (keyElement) {
                            keyElement.classList.add('active');
                            setTimeout(() => {
                                keyElement.classList.remove('active');
                            }, 800);
                        }
                    }
                }, note.delay);
            });
        }
        
        // DOM加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化音频上下文（在用户首次交互时）
            document.addEventListener('click', initAudioContext, { once: true });
            
            // 为每个按键添加点击事件
            document.querySelectorAll('.key').forEach(key => {
                key.addEventListener('mousedown', () => {
                    const keyChar = key.getAttribute('data-key');
                    handleKeyDown(keyChar);
                });
                
                // 防止拖拽产生不良效果
                key.addEventListener('dragstart', (e) => {
                    e.preventDefault();
                });
            });
            
            // 键盘事件监听
            document.addEventListener('keydown', (e) => {
                // 获取按下的键（大写）
                const key = e.key.toUpperCase();
                
                // 检查是否是我们支持的键
                if (keyToNote[key]) {
                    e.preventDefault(); // 防止默认行为（如页面滚动）
                    handleKeyDown(key);
                }
            });
            
            // 示例演奏按钮
            document.getElementById('playDemo').addEventListener('click', playDemoMelody);
            
            // 停止声音按钮
            document.getElementById('stopSound').addEventListener('click', stopAllSounds);
            
            // 音量控制
            const volumeSlider = document.getElementById('volume');
            volumeSlider.addEventListener('input', (e) => {
                volume = e.target.value / 100;
            });
            
            // 初始提示
            console.log("风之琴模拟器已加载！");
            console.log("使用键盘按键 QWERTYU (高音), ASDFGHJ (中音), ZXCVBNM (低音) 弹奏音乐。");
        });
    </script>
</body>
</html>